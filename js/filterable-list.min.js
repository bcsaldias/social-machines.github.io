function createFilterableList(e){function t(){u(),r(),i()}function r(){n(),a()}function n(){var e=l();A.selectAll(".filter-tag-item").classed("active",function(e){return k.includes(e)}).classed("teal",function(e){return k.includes(e)}).html(function(t){return t+' <span class="tag-count">'+(e[t]||0)+"</span>"})}function a(){var e=_.selectAll(".filtered-list-group").data(f,function(e){return e.key});e.exit().remove();var t=e.enter().append("div").attr("class","filtered-list-group");t.append("h3").attr("class","ui header").text(function(e){return"__null"===e.key?"Other":e.key});t.append("ul").attr("class","filtered-list-group-list "+(y||""));var r=t.merge(e).select("ul").selectAll(".filtered-list-item").data(function(e){return e.values},function(e){return e.id});r.exit().remove(),r.enter().append("li").attr("class","filtered-list-item").merge(r).html(h)}function i(){var e=x.length?encodeURIComponent(x):void 0,t=k.length?encodeURIComponent(k.join("__")):void 0,r=window.location.href;r=updateQueryParam(r=updateQueryParam(r,"q",e),"tags",t),window.history.replaceState({encodedInputString:e,encodedTags:t},"",r)}function l(){return d.reduce(function(e,t){return t[g]&&t[g].forEach(function(t){null==e[t]?e[t]=1:e[t]+=1}),e},{})}function u(){d=v.filter(c).filter(s),f=d3.nest().key(function(e){return null==e[m]?"__null":e[m]}).entries(d).sort(function(e,t){return t.key-e.key})}function c(e){if(!k.length)return!0;var t=e[g];return Array.isArray(t)||(t=[t]),k.every(function(e){return t.includes(e)})}function s(e){if(!x.trim().length)return!0;var t=["html","id"];return Object.keys(e).filter(function(e){return!t.includes(e)}).map(function(t){return e[t]}).join("\n").toLowerCase().includes(x.trim().toLowerCase())}function o(e){x=e,t()}var d,f,p=e.rootSelector,v=(e.title,e.data),g=e.tagKey,m=e.groupBy,h=e.renderItem,y=e.listClass,x="",k=[];!function(){var e=getUrlQueryParams();x=e.q||"",k=e.tags?e.tags.split("__"):[]}();var w=d3.select(p),A=(w.append("div").attr("class","ui input").append("input").attr("type","text").attr("class","filter-input").attr("placeholder","Search...").attr("value",x).on("change keyup",function(){o(this.value)}),w.append("div").attr("class","filter-tags"));A.append("div").attr("class","filter-label").text("Filter by Tag");var P=function(){var e={};return v.forEach(function(t){var r=t[g];null!=r&&(Array.isArray(r)?r.forEach(function(t){e[t]=!0}):e[r]=!0)}),Object.keys(e).sort()}();A.selectAll("a").data(P).enter().append("a").attr("class","filter-tag-item ui label").on("click",function(e){-1!==k.indexOf(e)?k.splice(k.indexOf(e),1):k.push(e),t()}).classed("active",function(e){return k.includes(e)}).classed("teal",function(e){return k.includes(e)}).text(function(e){return e});var _=w.append("div").attr("class","filtered-list");t()}function clearData(e){d3.select(e).html("")}function updateQueryParam(e,t,r){var n=new RegExp("([?&])"+t+"=.*?(&|#|$)","i");if(void 0===r)return e.match(n)?e.replace(n,"$1$2").replace(/&+/g,"&").replace(/&$/,"").replace(/\?$/,""):e;if(e.match(n))return e.replace(n,"$1"+t+"="+r+"$2");var a="";return-1!==e.indexOf("#")&&(a=e.replace(/.*#/,"#"),e=e.replace(/#.*/,"")),e+(-1!==e.indexOf("?")?"&":"?")+t+"="+r+a}function getUrlQueryParams(){var e,t=/\+/g,r=/([^&=]+)=?([^&]*)/g,n=function(e){return decodeURIComponent(e.replace(t," "))},a=window.location.search.substring(1);for(urlParams={};e=r.exec(a);)urlParams[n(e[1])]=n(e[2]);return urlParams}
