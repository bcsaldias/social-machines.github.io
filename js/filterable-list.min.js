function createFilterableList(e){function t(){s(),r(),l()}function r(){a(),n()}function n(){var e=P.selectAll(".filtered-list-super-group").data(f),t=e.enter().append("div").attr("class","filtered-list-super-group");t.append("h2").attr("class","ui header").attr("id",function(e){return e.id}).text(function(e){return e.header}),t.append("p").attr("class","empty-message").style("display","none").text("No items match the current filters."),t.append("div").attr("class","filtered-list-super-group-items"),t.merge(e).each(function(e){var t=d3.select(this);0==d3.sum(e.groupedItems,function(e){return e.values.length})?t.select(".empty-message").style("display","block"):t.select(".empty-message").style("display","none")}).select(".filtered-list-super-group-items").each(function(e){var t=d3.select(this);i(e.groupedItems,t,e)})}function a(){var e=u();O.selectAll(".filter-tag-item").classed("active",function(e){return k.includes(e)}).classed("teal",function(e){return k.includes(e)}).html(function(t){return t+' <span class="tag-count">'+(e[t]||0)+"</span>"})}function i(e,t,r){var n=t.selectAll(".filtered-list-group").data(e,function(e){return e.key});n.exit().remove();var a=n.enter().append("div").attr("class","filtered-list-group"),i=Object.assign({__null:"Other"},r.groupByLabels);a.append("h3").attr("class","ui header").text(function(e){var t=i[e.key];return null==t?e.key:t});a.append("ul").attr("class","filtered-list-group-list "+(x||""));var l=a.merge(n).select("ul").selectAll(".filtered-list-item").data(function(e){return e.values},function(e){return e.id});l.exit().remove(),l.enter().append("li").attr("class","filtered-list-item").merge(l).html(h)}function l(){var e=b.length?encodeURIComponent(b):void 0,t=k.length?encodeURIComponent(k.join("__")):void 0,r=window.location.href;r=updateQueryParam(r=updateQueryParam(r,"q",e),"tags",t),window.history.replaceState({encodedInputString:e,encodedTags:t},"",r)}function u(){return p.reduce(function(e,t){return t[v]&&t[v].forEach(function(t){null==e[t]?e[t]=1:e[t]+=1}),e},{})}function s(){p=w.filter(c).filter(o),f=g.map(function(e){var t=e.items.filter(c).filter(o),r=e.groupBy||y,n=d3.nest().key(function(e){return null==e[r]?"__null":e[r]}).entries(t).sort(function(e,t){return t.key-e.key});return Object.assign({},e,{groupedItems:n})})}function c(e){if(!k.length)return!0;var t=e[v];return Array.isArray(t)||(t=[t]),k.every(function(e){return t.includes(e)})}function o(e){if(!b.trim().length)return!0;var t=["html","id"];return Object.keys(e).filter(function(e){return!t.includes(e)}).map(function(t){return e[t]}).join("\n").toLowerCase().includes(b.trim().toLowerCase())}function d(e){b=e,t()}var p,f,m=e.rootSelector,g=(e.title,e.data),v=e.tagKey,y=e.groupBy,h=e.renderItem,x=e.listClass,b="",k=[],w=g.reduce(function(e,t){return e.concat(t.items)},[]);!function(){var e=getUrlQueryParams();b=e.q||"",k=e.tags?e.tags.split("__"):[]}();var A=d3.select(m),O=(A.append("div").attr("class","ui input").append("input").attr("type","text").attr("class","filter-input").attr("placeholder","Search...").attr("value",b).on("change keyup",function(){d(this.value)}),A.append("div").attr("class","filter-tags"));O.append("div").attr("class","filter-label").text("Filter by Tag");var I=function(){var e={};return w.forEach(function(t){var r=t[v];null!=r&&(Array.isArray(r)?r.forEach(function(t){e[t]=!0}):e[r]=!0)}),Object.keys(e).sort()}();O.selectAll("a").data(I).enter().append("a").attr("class","filter-tag-item ui label").on("click",function(e){-1!==k.indexOf(e)?k.splice(k.indexOf(e),1):k.push(e),t()}).classed("active",function(e){return k.includes(e)}).classed("teal",function(e){return k.includes(e)}).text(function(e){return e});var P=A.append("div").attr("class","filtered-list");t()}function clearData(e){d3.select(e).html("")}function updateQueryParam(e,t,r){var n=new RegExp("([?&])"+t+"=.*?(&|#|$)","i");if(void 0===r)return e.match(n)?e.replace(n,"$1$2").replace(/&+/g,"&").replace(/&$/,"").replace(/\?$/,""):e;if(e.match(n))return e.replace(n,"$1"+t+"="+r+"$2");var a="";return-1!==e.indexOf("#")&&(a=e.replace(/.*#/,"#"),e=e.replace(/#.*/,"")),e+(-1!==e.indexOf("?")?"&":"?")+t+"="+r+a}function getUrlQueryParams(){var e,t=/\+/g,r=/([^&=]+)=?([^&]*)/g,n=function(e){return decodeURIComponent(e.replace(t," "))},a=window.location.search.substring(1);for(urlParams={};e=r.exec(a);)urlParams[n(e[1])]=n(e[2]);return urlParams}
